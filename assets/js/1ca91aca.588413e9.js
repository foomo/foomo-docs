"use strict";(self.webpackChunkfoomo=self.webpackChunkfoomo||[]).push([[3925],{6567:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var o=t(5893),r=t(3905);const s={},i="Working with the Gocontentful API",l={id:"projects/cms/gocontentful/working-with-gocontentful-api",title:"Working with the Gocontentful API",description:"Let's consider a very simple use case where you have a Contentful space where you store information",source:"@site/docs/projects/cms/gocontentful/04-working-with-gocontentful-api.md",sourceDirName:"projects/cms/gocontentful",slug:"/projects/cms/gocontentful/working-with-gocontentful-api",permalink:"/docs/projects/cms/gocontentful/working-with-gocontentful-api",draft:!1,unlisted:!1,editUrl:"https://github.com/foomo/foomo-docs/tree/main/foomo/docs/projects/cms/gocontentful/04-working-with-gocontentful-api.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"projectsSidebar",previous:{title:"Play with the test API",permalink:"/docs/projects/cms/gocontentful/test-api"},next:{title:"Caching",permalink:"/docs/projects/cms/gocontentful/caching"}},a={},c=[{value:"Get a client",id:"get-a-client",level:3},{value:"Environments support",id:"environments-support",level:3},{value:"Working with entries",id:"working-with-entries",level:3},{value:"Assets",id:"assets",level:3},{value:"Working with RichText",id:"working-with-richtext",level:3},{value:"More on references",id:"more-on-references",level:3},{value:"Other useful functions",id:"other-useful-functions",level:3},{value:"Caveats and limitations",id:"caveats-and-limitations",level:3}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.ah)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"working-with-the-gocontentful-api",children:"Working with the Gocontentful API"}),"\n",(0,o.jsx)(n.p,{children:"Let's consider a very simple use case where you have a Contentful space where you store information\nabout people and their pets.\nTo generate a go package to manipulate those entries, run the following in your terminal:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"$ gocontentful -spaceid YOUR_SPACE_ID -cmakey YOUR_CMA_API_TOKEN -contenttypes person,pet path/to/your/go/project/folder/people \n"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.strong,{children:"-contenttypes"})," parameter is optional. If not specified, gocontentful will generate an API that supports all the content types of the space."]}),"\n",(0,o.jsx)(n.p,{children:"Gocontentful will scan the space, download locales and content types and generate the Go API files in the target path:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"path/to/your/go/project/folder/people\n|-gocontentfulvobase.go\n|-gocontentfulvolib_person.go // One file for each content type\n|-gocontentfulvolib_pet.go    // One file for each content type\n|-gocontentfulvolib.go\n|-gocontentfulvo.go\n"})}),"\n",(0,o.jsxs)(n.p,{children:["We recommend not passing the ",(0,o.jsx)(n.em,{children:"-cmakey"})," parameter but rather log in first using the Contentful CLI.\nThis will be remembered in all subsequent runs. See the ",(0,o.jsx)(n.a,{href:"./getting-started#optional-tools",children:"Getting started chapter"})]}),"\n",(0,o.jsx)(n.p,{children:"Note: Do NOT modify the generated files! If you change the content model in Contentful just run gocontentful\nagain. This will update the files for you."}),"\n",(0,o.jsx)(n.h3,{id:"get-a-client",children:"Get a client"}),"\n",(0,o.jsx)(n.p,{children:'The generated files will be in the "people" subdirectory of your project. Your go program can get a Contentful\nclient from them:'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"cc, err := people.NewContentfulClient(YOUR_SPACE_ID, people.ClientModeCDA, YOUR_API_KEY, 1000, contentfulLogger, people.LogDebug,false)\n"})}),"\n",(0,o.jsx)(n.p,{children:"The parameters to pass to NewContentfulClient are:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.em,{children:"spaceID"})," (string)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.em,{children:"clientMode"})," (string) supports the constants ClientModeCDA, ClientModeCPA and ClientModeCMA. If you need to operate\non multiple APIs (e.g. one for reading and CMA for writing) you need to get two clients"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.em,{children:"clientKey"})," (string) is your API key (generate one for your API at Contentful)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.em,{children:"optimisticPageSize"})," (uint16) is the page size the client will use to download entries from the space for caching.\nContentful's default is 100 but you can specify up to 1000: this might get you into an error because Contentful\nlimits the payload response size to 70 KB but the client will handle the error and reduce the page size automatically\nuntil it finds a proper value. Hint: using a big page size that always fails is a waste of time and resources because\na lot of initial calls will fail, whereas a too small one will not leverage the full download bandwidth. It's a\ntrial-and-error and you need to find the best value for your case. For simple content types you can start with 1000,\nfor very complex ones that include fat fields you might want to get down to 100 or even less."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.em,{children:"logFn"})," is a func(fields map[string]interface",", level int, args ...interface",") that the client will call whenever\nit needs to log something. It can be nil if you don't need logging and that will be handled gracefully but it's not\nrecommended. A simple function you can pass that uses the ",(0,o.jsx)(n.a,{href:"https://github.com/Sirupsen/logrus",children:"https://github.com/Sirupsen/logrus"})," package might look\nsomething like this:"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"contentfulLogger := func(fields map[string]interface{}, level int, args ...interface{}) {\n    switch level {\n    case people.LogDebug:\n        log.WithFields(fields).Debug(args)\n    case people.LogInfo:\n        log.WithFields(fields).Info(args)\n    case people.LogWarn:\n        log.WithFields(fields).Warn(args)\n    case people.LogError:\n        log.WithFields(fields).Error(args)\n    default:\n        return\n    }\n}\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.em,{children:"logLevel"})," (int) is the debug level (see function above). Please note that LogDebug is very verbose and even logs\nwhen you request a field value but that is not set for the entry."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.em,{children:"debug"})," (bool) is the Contentful API client debug switch. If set to ",(0,o.jsx)(n.em,{children:"true"})," it will log on stdout all the CURL calls\nto Contentful. This is extremely verbose and extremely valuable when something fails in a call to the API because\nit's the only way to see the REST API response."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.em,{children:"NOTE:"})," Gocontentful provides an offline version of the client that can load data from a JSON space export file\n(as exported by the ",(0,o.jsx)(n.em,{children:"contentful"})," CLI tool). This is the way you can write unit tests against your generated API that\ndon't require to be online and the management of a safe API key storage. See the ",(0,o.jsx)(n.a,{href:"./api-reference",children:"API Reference"})]}),"\n",(0,o.jsx)(n.h3,{id:"environments-support",children:"Environments support"}),"\n",(0,o.jsx)(n.p,{children:"Gocontentful supports Contentful environments in two ways:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Code can be generated loading the content model from an environment other than master.\nThis is done passing the -environment flag on the command  line to specify the environment you want to load the model from."}),"\n",(0,o.jsx)(n.li,{children:'The gocontentful client in your application can be switched to any environment with the SetEnvironment method.\nFor example, if your space has an extra environment named "devplayground" you can switch the API to use it with:'}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'cc.SetEnvironment("devplayground") \n'})}),"\n",(0,o.jsx)(n.p,{children:"To reset the environment to master pass an empty string."}),"\n",(0,o.jsx)(n.h3,{id:"working-with-entries",children:"Working with entries"}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.a,{href:"./test-api",children:"the previous chapter"})," for an introduction on entry operations.\nWith your newly created client you can do things like:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'// Load all persons\npersons, err := cc.GetAllPerson() \n// Load a specific person\nperson, err := cc.GetPersonByID(THE_PERSON_ID)\n// or pass a query\nperson, err := GetFilteredPerson(&contentful.Query{\n\t"contentType":"person",\n    "exists": []string{"fields.resume"}\n})\n// The person\'s name\nname := person.Name()\n// The work title in a different localization. Available locales are generated as constants.\n// If a space is configured to have a fallback from one locale to the default one, \n// the getter functions will return that if the value is not set for locale passed to the function.\nname := person.Title(people.SpaceLocaleItalian) \n// Get references to the person\'s pets\npetRefs := person.Pets()\n// Deal with pets\nfor _, pet := range petRefs {\nswitch pet.ContentType {\ncase people.ContentTypeDog: // you have these constants in the generated code\ndog := pet.VO.(*people.Dog)\n// do something with dog\ncase people.ContentTypeCat:\n// ...\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Once you have loaded an entry, you can use any of the setter methods to alter the fields. For example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"dog.SetAge(7)\n"})}),"\n",(0,o.jsx)(n.p,{children:"This will only affect the Go object and doesn't automatically propagate to the space.\nTo save the entry to Contentful you need to explicitly call one of these methods:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"// Upsert (save) an entry\nerr := dog.UpsertEntry()\n// Publish it (after it's been upserted)\nerr := dog.PublishEntry() // change your mind with err := dog.UnpublishEntry()\n// Or do it in one step\nerr := dog.UpdateEntry() // upserts and publishes\n// And delete it\nerr := dog.DeleteEntry()\n"})}),"\n",(0,o.jsxs)(n.p,{children:["If you want to know the publication status of an entry as represented in Contentful's UI you\ncan use the ",(0,o.jsx)(n.code,{children:"GetPublishingStatus()"})," method on the entry itself. Possible return values are the\npredefined constants ",(0,o.jsx)(n.code,{children:"StatusDraft"}),", ",(0,o.jsx)(n.code,{children:"StatusChanged"})," and ",(0,o.jsx)(n.code,{children:"StatusPublished"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"When saving, publishing or deleting entries:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["You need a client that uses mode ",(0,o.jsx)(n.em,{children:"ClientModeCMA"}),". Entries retrieved with ClientModeCDA\nor ClientModeCPA can be saved in memory (for example if you need to enrich the built-in cache) but not persisted to\nContentful."]}),"\n",(0,o.jsx)(n.li,{children:"Make sure you Get a fresh copy of the entry right before you manipulate it and upsert it / publish it to Contentful. In case it's\nsaved by someone else in the meantime, the upsert will fail with a version mismatch error."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"In case you need a completely new entry just create it, Contentful will fill in the technical details for you:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"NewCfPerson(contentfulClient ...*ContentfulClient) (cfPerson *CfPerson)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"assets",children:"Assets"}),"\n",(0,o.jsx)(n.p,{children:"Contentful allows upload and reference of binary assets and gocontentful fully supports them.\nAssuming the dog entry references a picture in a field you can get it with:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"picture := dog.Picture() // you can pass a locale to this function as usual\n"})}),"\n",(0,o.jsx)(n.p,{children:"This returns a *contenful.AssetNoLocale object handling localization for you in two ways.\nFirst, the field itself could be localized in the model, referencing two different assets altogether.\nSecondly, the asset itself can have different files uploaded for different locales.\nNo matter what, the gocontentful API will return the right file:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"// Get the asset's URL at Contentful's CDN\nif picture != nil && picture.Fields != nil && picture.Fields.File != nil {\n    theURL := picture.Fields.File.URL\n    // ...then do something with it\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["There are various functions and methods to work with assets, for example to create an asset\nstarting from an URL or to convert an asset to a reference to store it in a parent entry\nfield. See the ",(0,o.jsx)(n.a,{href:"./api-reference",children:"API Reference"})," chapter for details."]}),"\n",(0,o.jsxs)(n.p,{children:["Note: there is no function to create a new asset in the generated code because the type ",(0,o.jsx)(n.code,{children:"AssetNoLocale"}),"\nis from the ",(0,o.jsx)(n.em,{children:"github.com/foomo/contentful"})," package, just instantiate one if you need a blank asset."]}),"\n",(0,o.jsx)(n.h3,{id:"working-with-richtext",children:"Working with RichText"}),"\n",(0,o.jsx)(n.p,{children:"Contentful supports Rich Text fields. Behind the scenes, these are JSON objects that represent\nthe content through a Contentful-specific data model. Sooner or later you might want to convert such values to and from HTML.\nGocontentful supports the conversion both ways. For instance, you want a person's resume to be converted to HTML:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"htmlText := people.RichTextToHtml(person.Resume(), linkResolver, entryLinkResolver, imageResolver, embeddedEntryResolver locale)\n"})}),"\n",(0,o.jsx)(n.p,{children:"The parameters linkResolver, entryLinkResolver, embeddedEntryResolver and imageResolver are all functions that you can pass\nto convert various elements inserted by the user into the RichText field:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"linkResolver will allow you to create custom HTML tags for hyperlinks. If left blank, RichTextToHtml will just output an A tag."}),"\n",(0,o.jsx)(n.li,{children:"entryLinkResolver is used to create hyperlinks with custom URLs when the destination in Contentful is another entry.\nIf you allow such links to be created in the editor then you must pass this function."}),"\n",(0,o.jsx)(n.li,{children:"imageResolver and embebbedEntryResolver are needed when the field accepts assets and entries embedded into the content, to turn\nthese into actual HTML snippets"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The conversion works the other way around too, when you need to source data from outside and create Contentful entries:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"myRichText := HtmlToRichText(htmlSrc)\n"})}),"\n",(0,o.jsxs)(n.p,{children:["See the ",(0,o.jsx)(n.a,{href:"./api-reference",children:"API Reference"})," for more details about these functions."]}),"\n",(0,o.jsx)(n.h3,{id:"more-on-references",children:"More on references"}),"\n",(0,o.jsx)(n.p,{children:"When working with references it's often useful to know if there are any broken ones in the space.\nThis happens when a published entry references another that has been deleted after the parent\nwas published. This might create issues if your application code doesn't degrade content gracefully.\nTo get a report of all broken references you can use the following function:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"(cc *ContentfulClient) BrokenReferences() (brokenReferences []BrokenReference)\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Note that this only works with cached clients. See ",(0,o.jsx)(n.a,{href:"./caching",children:"the next chapter on caching"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Also on references: when you want to reference entry B from entry A, you cannot assign\nthe value object of entry B to the reference field in A. First you need to convert the\nobject to a ",(0,o.jsx)(n.code,{children:"ContentTypeSys"})," object because that's what Contentful expects in reference fields:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"(vo *CfPerson) ToReference() (refSys ContentTypeSys)\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Finally, you can get the parents (AKA referring) entries of either an entry or\nan EntryReference with the ",(0,o.jsx)(n.em,{children:"GetParents()"})," method. This returns a slice of ",(0,o.jsx)(n.code,{children:"[]EntryReference"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"(vo *CfPerson) GetParents() (parents []EntryReference, err error)\n(ref *EntryReference) GetParents(cc *ContentfulClient) (parents []EntryReference, err error)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"other-useful-functions",children:"Other useful functions"}),"\n",(0,o.jsx)(n.p,{children:"Another thing you might want to know is the content type of an entry with a given ID:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"(cc *ContentfulClient) GetContentTypeOfID(ID string) (contentType string)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"caveats-and-limitations",children:"Caveats and limitations"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:'Avoid creating content types that have field IDs equal to reserved Go words (e.g. "type").\nGocontentful won\'t scan for them and the generated code will break.'}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.ah)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},3905:(e,n,t)=>{t.d(n,{ah:()=>c});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)t=s[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)t=s[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var a=o.createContext({}),c=function(e){var n=o.useContext(a),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},h={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,s=e.originalType,a=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=c(t),p=r,f=u["".concat(a,".").concat(p)]||u[p]||h[p]||s;return t?o.createElement(f,i(i({ref:n},d),{},{components:t})):o.createElement(f,i({ref:n},d))}));d.displayName="MDXCreateElement"}}]);